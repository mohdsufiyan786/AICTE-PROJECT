<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Student Dashboard | NoteVerse</title>
    <link rel="stylesheet" href="/public/style.css">
    <link rel="stylesheet" href="/public/upload-style.css">
    <link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
</head>
<body>

<div class="dashboard-container">

    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
        <div class="sidebar-header">
            <div class="brand-flex">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none">
                    <path d="M4 19.5A2.5 2.5 0 0 1 6.5 17H20" stroke="#f5a623" stroke-width="2.5" stroke-linecap="round"/>
                    <path d="M6.5 2H20V22H6.5A2.5 2.5 0 0 1 4 19.5V4.5A2.5 2.5 0 0 1 6.5 2Z" stroke="#f5a623" stroke-width="2.5" stroke-linejoin="round"/>
                </svg>
                NoteVerse
            </div>
            <button class="close-sidebar-btn" onclick="toggleSidebar()">‚úï</button>
        </div>

        <ul class="sidebar-menu">
            <li class="active"><a href="#"><i class="fas fa-home" style="width:16px"></i> Home</a></li>
            <li><a href="/views/my_library.html"><i class="fas fa-book" style="width:16px"></i> My Library</a></li>
            <li><a href="download.html"><i class="fas fa-download" style="width:16px"></i> Downloads</a></li>

            

            <li><a href="/views/my_uploads/my-uploads.html">
                <i class="fas fa-upload"></i> My Uploads
            </a></li>
            <li><a href="#"><i class="fas fa-heart" style="width:16px"></i> Favorites</a></li>
            <li><a href="faculty_profile.html"><i class="fas fa-cog" style="width:16px"></i> Profile</a></li>
        </ul>

        <div class="sidebar-footer">
            <a href="/views/login.html" class="logout-btn">
                <i class="fas fa-sign-out-alt"></i> Log Out
            </a>
        </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">

        <!-- Header -->
        <header class="top-header animate-fade-down">
            <div class="header-left">
                <button class="hamburger-btn" onclick="toggleSidebar()">
                    <svg width="22" height="22" viewBox="0 0 24 24" stroke="currentColor" stroke-width="2.5" fill="none">
                        <line x1="3" y1="6" x2="21" y2="6"></line>
                        <line x1="3" y1="12" x2="21" y2="12"></line>
                        <line x1="3" y1="18" x2="21" y2="18"></line>
                    </svg>
                </button>
                <div class="welcome-text">
                    <h1 id="user-welcome-name">Hi, User üëã</h1>
                    <p class="hide-on-mobile">Ready to learn something new today?</p>
                </div>
            </div>

            <div class="profile-section">
                <button class="upload-note-btn">
                    <span class="plus-icon">+</span>
                    <span class="btn-text">Upload Note</span>
                </button>
                <div class="profile-pic" id="userAvatar">MK</div>
            </div>
        </header>

        <!-- Search Section -->
        <div class="search-section animate-fade-up">
            <div class="search-bar-container">
                <span class="search-icon">üîç</span>
                <input type="text" id="searchNotes" placeholder="Search notes, subjects, authors...">
                <button class="filter-btn" id="filterToggle">‚ö° Filters</button>
            </div>

            <!-- Filter Panel -->
            <div id="filterPanel" style="display:none; margin-top:12px; background:var(--bg-card); border:1px solid var(--border); border-radius:var(--radius-sm); padding:16px; display:none; gap:12px; flex-wrap:wrap;">
                <select id="filterCourse" style="background:var(--bg-secondary);border:1px solid var(--border);color:var(--text-primary);padding:8px 12px;border-radius:8px;font-family:'DM Sans',sans-serif;outline:none;">
                    <option value="">All Courses</option>
                    <option value="BCA">BCA</option>
                    <option value="B.Tech">B.Tech</option>
                    <option value="MBA">MBA</option>
                </select>
                <select id="filterSem" style="background:var(--bg-secondary);border:1px solid var(--border);color:var(--text-primary);padding:8px 12px;border-radius:8px;font-family:'DM Sans',sans-serif;outline:none;">
                    <option value="">All Semesters</option>
                    <option value="1st">1st Sem</option>
                    <option value="2nd">2nd Sem</option>
                    <option value="3rd">3rd Sem</option>
                    <option value="4th">4th Sem</option>
                    <option value="5th">5th Sem</option>
                    <option value="6th">6th Sem</option>
                </select>
                <button onclick="applyFilters()" style="background:var(--accent);color:#0d0f14;border:none;padding:8px 16px;border-radius:8px;font-weight:600;cursor:pointer;">Apply</button>
                <button onclick="clearFilters()" style="background:var(--bg-secondary);color:var(--text-secondary);border:1px solid var(--border);padding:8px 16px;border-radius:8px;font-weight:600;cursor:pointer;">Clear</button>
            </div>

            <div class="categories-scroll" id="categoryPills">
                <button class="cat-pill active" data-cat="all">All</button>
                <button class="cat-pill" data-cat="BCA">BCA</button>
                <button class="cat-pill" data-cat="B.Tech">B.Tech</button>
                <button class="cat-pill" data-cat="MBA">MBA</button>
                <button class="cat-pill" data-cat="1st">1st Sem</button>
                <button class="cat-pill" data-cat="2nd">2nd Sem</button>
                <button class="cat-pill" data-cat="Notes">Notes</button>
                <button class="cat-pill" data-cat="PYQ">PYQ Papers</button>
            </div>
        </div>

        <!-- Notes Grid -->
        <div class="notes-grid-section animate-fade-up delay-1">
            <div id="notesContainer" class="notes-grid">
                <!-- Skeleton loaders -->
                <div class="note-card" style="gap:12px">
                    <div class="skeleton" style="height:20px;width:60px;border-radius:50px"></div>
                    <div class="skeleton" style="height:48px;width:48px;border-radius:12px"></div>
                    <div class="skeleton" style="height:18px;width:80%"></div>
                    <div class="skeleton" style="height:14px;width:50%"></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                        <div class="skeleton" style="height:38px;border-radius:10px"></div>
                        <div class="skeleton" style="height:38px;border-radius:10px"></div>
                    </div>
                </div>
                <div class="note-card" style="gap:12px">
                    <div class="skeleton" style="height:20px;width:60px;border-radius:50px"></div>
                    <div class="skeleton" style="height:48px;width:48px;border-radius:12px"></div>
                    <div class="skeleton" style="height:18px;width:80%"></div>
                    <div class="skeleton" style="height:14px;width:50%"></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                        <div class="skeleton" style="height:38px;border-radius:10px"></div>
                        <div class="skeleton" style="height:38px;border-radius:10px"></div>
                    </div>
                </div>
                <div class="note-card" style="gap:12px">
                    <div class="skeleton" style="height:20px;width:60px;border-radius:50px"></div>
                    <div class="skeleton" style="height:48px;width:48px;border-radius:12px"></div>
                    <div class="skeleton" style="height:18px;width:80%"></div>
                    <div class="skeleton" style="height:14px;width:50%"></div>
                    <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                        <div class="skeleton" style="height:38px;border-radius:10px"></div>
                        <div class="skeleton" style="height:38px;border-radius:10px"></div>
                    </div>
                </div>
            </div>
        </div>

    </main>
</div>

<!-- Upload Modal -->
<div id="uploadModal" class="modal-overlay">
    <div class="modal-card">
        <div class="modal-header">
            <div class="header-icon">
                <i class="fas fa-cloud-upload-alt"></i>
            </div>
            <div class="header-title">
                <h2>Upload Study Material</h2>
                <p>Share your notes with the community</p>
            </div>
            <span class="close-btn" id="closeModal">&times;</span>
        </div>

        <form id="uploadNoteForm" class="professional-form">
            <div class="form-row">
                <div class="input-group">
                    <label><i class="fas fa-graduation-cap"></i> Course</label>
                    <select id="courseSelect" required>
                        <option value="" disabled selected>Select Course</option>
                        <option value="BCA">BCA</option>
                        <option value="B.Tech">B.Tech</option>
                        <option value="MBA">MBA</option>
                    </select>
                </div>
                <div class="input-group">
                    <label><i class="fas fa-layer-group"></i> Semester</label>
                    <select id="semSelect" required>
                        <option value="" disabled selected>Select Semester</option>
                        <option value="1st">1st Sem</option>
                        <option value="2nd">2nd Sem</option>
                        <option value="3rd">3rd Sem</option>
                        <option value="4th">4th Sem</option>
                        <option value="5th">5th Sem</option>
                        <option value="6th">6th Sem</option>
                    </select>
                </div>
            </div>

            <div class="input-group">
                <label><i class="fas fa-book"></i> Note Title / Subject</label>
                <input type="text" id="noteTitle" placeholder="e.g. Data Structures Unit 1" required>
            </div>

            <div class="file-upload-wrapper">
                <input type="file" id="noteFile" accept=".pdf" name="noteFile" required>
                <div class="file-dummy">
                    <i class="fas fa-file-pdf"></i>
                    <span id="fileNameDisplay">Click to choose PDF Note</span>
                    <span style="font-size:12px;color:var(--text-muted)">Only PDF files ‚Ä¢ Max 10MB</span>
                </div>
            </div>

            <button type="submit" id="submitBtn" class="submit-btn-animated">
                <span>Start Upload</span>
                <i class="fas fa-arrow-right"></i>
            </button>

            <p id="uploadStatus" style="text-align:center;font-size:13px;color:var(--text-secondary);"></p>
        </form>
    </div>
</div>

<!-- File Info Box -->
<div id="fileInfoBox" class="gov-file-info" style="display:none;">
    <i class="fas fa-file-pdf"></i>
    <span id="selectedFileName">No file selected</span>
    <span id="removeFile" style="color:var(--accent-2);cursor:pointer;margin-left:auto;font-size:18px;font-weight:bold;">&times;</span>
</div>

<script>
function toggleSidebar() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    sidebar.classList.toggle('open');
    overlay.classList.toggle('open');
}

// Category Pills Filter
let currentCategory = 'all';
window.allNotes = [];

document.querySelectorAll('.cat-pill').forEach(pill => {
    pill.addEventListener('click', () => {
        document.querySelectorAll('.cat-pill').forEach(p => p.classList.remove('active'));
        pill.classList.add('active');
        currentCategory = pill.dataset.cat;
        filterAndRender();
    });
});

// Search
document.getElementById('searchNotes').addEventListener('input', filterAndRender);

// Filter Toggle
document.getElementById('filterToggle').addEventListener('click', () => {
    const panel = document.getElementById('filterPanel');
    panel.style.display = panel.style.display === 'none' || panel.style.display === '' ? 'flex' : 'none';
});

function applyFilters() {
    filterAndRender();
}

function clearFilters() {
    document.getElementById('filterCourse').value = '';
    document.getElementById('filterSem').value = '';
    filterAndRender();
}

function filterAndRender() {
    const search = document.getElementById('searchNotes').value.toLowerCase();
    const filterCourse = document.getElementById('filterCourse').value;
    const filterSem = document.getElementById('filterSem').value;

    let filtered = (window.allNotes || []).filter(note => {
        const matchSearch = !search ||
            (note.title || '').toLowerCase().includes(search) ||
            (note.course || '').toLowerCase().includes(search) ||
            (note.uploadedBy || '').toLowerCase().includes(search);

        const matchCat = currentCategory === 'all' ||
            (note.course || '').includes(currentCategory) ||
            (note.semester || '').includes(currentCategory);

        const matchCourse = !filterCourse || note.course === filterCourse;
        const matchSem = !filterSem || (note.semester || '').includes(filterSem);

        return matchSearch && matchCat && matchCourse && matchSem;
    });

    renderNotes(filtered);
}

window.renderNotes = function(notes) {
    const container = document.getElementById('notesContainer');
    if (notes.length === 0) {
        container.innerHTML = `
            <div class="empty-state">
                <div class="empty-icon">üì≠</div>
                <h3>No notes found</h3>
                <p>Try different filters or be the first to upload!</p>
            </div>`;
        return;
    }
    container.innerHTML = notes.map(note => createCard(note)).join('');
}

function createCard(note) {
    const colors = ['#f5a623','#ff6b6b','#4ecdc4','#a78bfa','#34d399'];
    const color = colors[Math.floor(Math.random() * colors.length)];
    return `
        <div class="note-card animate-fade-up">
            <div class="card-badge">${note.course || 'General'}</div>
            <div class="card-icon" style="background:${color}18;color:${color}">
                <i class="fas fa-file-pdf"></i>
            </div>
            <h3 class="note-title">${note.title || 'Untitled Note'}</h3>
            <p class="note-meta">
                By ${note.uploadedBy || 'Anonymous'} ‚Ä¢
                <span>${note.semester || ''}</span>
            </p>
            <div class="card-filename">
                <i class="fas fa-paperclip" style="color:var(--accent)"></i>
                ${note.fileName || note.title || 'Note'}.pdf
            </div>
            <div class="card-footer" style="display:flex;gap:10px;margin-top:12px;">
    <a href="${note.fileUrl}" target="_blank" style="flex:1;text-decoration:none;">
        <button style="width:100%;padding:10px;border-radius:10px;background:#1f2333;border:1.5px solid #2d3147;color:#8b91a7;font-weight:600;font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">
            üëÅ View
        </button>
    </a>
    <a href="${note.fileUrl}" download style="flex:1;text-decoration:none;">
        <button style="width:100%;padding:10px;border-radius:10px;background:linear-gradient(135deg,#f5a623,#e09520);border:none;color:#0d0f14;font-weight:700;font-size:13px;cursor:pointer;display:flex;align-items:center;justify-content:center;gap:6px;">
            ‚¨á Download
        </button>
    </a>
</div>

        </div>`;

    
        
}
</script>

<script type="module" src="notes-renderer.js"></script>
<script type="module" src="upload-logic.js"></script>
<script type="module" src="/dashboard-logic.js"></script>
<script type="module">
    import { setupLogout } from "./auth-guard.js";
    setupLogout();
</script>

</body>
</html>
